import{a as r}from"./audio-BXh7UfBs.js";import{s}from"./loading-ChqFcCVw.js";$(document).ready(function(){$("#order_control_id").focus()});$("#order_control_id").on("change",function(){$("#order_control_id").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/shipping_inspection/ajax_check_order_control_id",type:"POST",data:{order_control_id:$("#order_control_id").val()},dataType:"json",success:function(e){try{if(e.error_message)throw $("#order_control_id").val(null),$("#order_control_id").focus(),new Error(e.error_message);$("#order_control_id").prop("disabled",!0),$("#order_control_id").addClass("bg-gray-200"),$("#tracking_no").focus(),$("#message").html(null),r("proc")}catch(o){r("ng"),$("#message").html(o.message)}},error:function(){alert("失敗")}})});$("#tracking_no").on("change",function(){$("#tracking_no").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/shipping_inspection/ajax_check_tracking_no",type:"POST",data:{order_control_id:$("#order_control_id").val(),tracking_no:$("#tracking_no").val()},dataType:"json",success:function(e){try{if(e.error_message)throw $("#tracking_no").val(null),$("#tracking_no").focus(),new Error(e.error_message);$("#tracking_no").prop("disabled",!0),$("#tracking_no").addClass("bg-gray-200"),n(),$("#message").html(null),l(e.inspection_targets),a(),r("proc")}catch(o){r("ng"),$("#message").html(o.message)}},error:function(){alert("失敗")}})});function l(t){for(let e of t){let o=$("<tr id='"+e.order_item_id+"' class='text-left hover:bg-theme-sub cursor-default whitespace-nowrap'>");o.append($("<td class='py-1 px-2 border'>").text(e.item_jan_code)),o.append($("<td class='py-1 px-2 border'>").text(e.model_jan_code)),o.append($("<td class='py-1 px-2 border'>").text(e.item_name)),o.append($("<td class='order_quantity py-1 px-2 border text-right'>").text(e.order_quantity)),o.append($("<td class='inspection_quantity py-1 px-2 border text-right'>").text(0)),$("#inspection_target_table").append(o)}}$("#item_id_code").on("change",function(){$("#item_id_code").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/shipping_inspection/ajax_check_item_id_code",type:"POST",data:{order_control_id:$("#order_control_id").val(),item_id_code:$("#item_id_code").val()},dataType:"json",success:function(e){try{if(e.error_message)throw new Error(e.error_message);if(e.exp_lot_check_result)throw new Error(e.exp_lot_check_result);if(e.item_id_type==="JAN"&&!e.inspection){$("#lot_input_modal").removeClass("hidden"),$("#lot").val(null),$("#lot_length").text("("+(e.progress[e.order_item_id].lot_1_length+e.progress[e.order_item_id].lot_2_length)+"桁)"),$("#lot").focus();return}_(e)}catch(o){c(o.message)}},error:function(){alert("失敗")}})});function _(t){t.inspection&&(n(),$("#message").html(null),$("#"+t.order_item_id+" .inspection_quantity").text(t.inspection_quantity),a(),t.inspection_complete&&$("#"+t.order_item_id).appendTo($("#inspection_complete_table")),t.inspection_complete_order&&(s(),$("#item_id_code").prop("disabled",!0),$("#item_id_code").addClass("bg-gray-200"),r("complete",function(){$("#order_control_id").prop("disabled",!1),$("#shipping_inspection_form").submit()})),r("proc"))}function c(t){r("ng"),$("#item_id_code_alert_modal").removeClass("hidden"),$("#error_message").html(t),$("#item_id_code_alert_modal_focus_element").focus()}$("#lot").on("change",function(){if($("#lot").val()){$("#lot_input_modal").addClass("hidden");var t="/shipping_inspection/ajax_check_lot";$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:t,type:"POST",data:{order_control_id:$("#order_control_id").val(),lot:$("#lot").val()},dataType:"json",success:function(e){try{if(n(),e.error_message)throw new Error(e.error_message);_(e)}catch(o){c(o.message)}},error:function(){alert("失敗")}})}});$("#item_id_code_alert_modal_focus_element").on("change",function(){r("ng"),$("#item_id_code_alert_modal_focus_element").val(null),$("#item_id_code_alert_modal_focus_element").focus()});const i=$("#item_id_code_alert_modal_focus_element");i.on("blur",function(){setTimeout(()=>{i.focus()},0)});function n(){$("#item_id_code").val(null),$("#item_id_code").focus()}function a(){let t=0,e=0;$(".order_quantity").each(function(){t+=parseInt($(this).text())}),$(".inspection_quantity").each(function(){e+=parseInt($(this).text())}),$("#remaining_pcs").html(t-e)}$(document).on("click",function(t){t.target.classList.contains("item_id_code_alert_modal_close")==!0&&($("#item_id_code_alert_modal").addClass("hidden"),n()),t.target.classList.contains("lot_input_modal_close")==!0&&($("#lot_input_modal").addClass("hidden"),n(),$("#message").html("LOT入力が中断されました。"),r("ng"))});
