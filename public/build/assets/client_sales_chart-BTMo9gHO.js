import{C as y}from"./chartjs-plugin-datalabels.esm-CglBOSix.js";import{c as E}from"./chart_color-CmXEACsr.js";$(document).ready(function(){j()});function j(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/client_detail/ajax_get_chart_data",type:"GET",data:{client_id:$("#client_id").val()},dataType:"json",success:function(i){try{const t=document.getElementById("client_sales_chart_div");t.innerHTML="",i.base_clients.forEach(n=>{const e=n.base_client_id,r=n.base_name,c=i.client_sales[e]||[],o=document.createElement("div");o.classList.add("w-full","p-2","bg-white","rounded-2xl","shadow-md","col-span-6"),o.id="client_sales_wrapper_"+e;const l=document.createElement("div");l.classList.add("flex","justify-between","items-center","px-5");const u=document.createElement("p");u.textContent="売上推移("+r+")",u.classList.add("text-base");const p=document.createElement("div");p.classList.add("flex","items-center","gap-2");const a=document.createElement("select");a.id="yearSelect_"+e,a.classList.add("text-sm","rounded-lg"),a.dataset.baseClientId=e;const g=new Date().getFullYear();for(let s=1;s<=5;s++){const h=g-s,b=document.createElement("option");b.value=h,b.textContent=h+"年",a.appendChild(b)}const m=document.createElement("button");m.classList.add("btn","bg-btn-enter","text-white","rounded-lg","px-5","py-2","add_year_button"),m.textContent="追加",m.dataset.baseClientId=e,p.appendChild(a),p.appendChild(m),l.appendChild(u),l.appendChild(p),o.appendChild(l);const _=document.createElement("canvas");_.id="client_sales_chart_"+e,_.classList.add("w-full","bg-white"),_.height=300,o.appendChild(_),t.appendChild(o);const x=Array.from({length:12},(s,h)=>h+1+"月"),C=f(c,e),v=_.getContext("2d");new y(v,{type:"line",data:{labels:x,datasets:C},options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:1e8,min:0,stepSize:1e6}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{callbacks:{title:function(s){return s[0].dataset.yearMonthJp[s[0].dataIndex]},label:function(s){return s.formattedValue+"円"}},bodyFont:{size:16},titleFont:{size:18},padding:12,boxPadding:6}}}})})}catch{alert("グラフの生成に失敗しました。")}},error:function(){alert("グラフの生成に失敗しました。")}})}function f(d,i){const t=y.getChart("client_sales_chart_"+i),n=Object.values(E),e=t?t.data.datasets.length:0,r=n[e%n.length];let c=[],o=[];const l=d.length===0?"":d[0].year_month.split("-")[0];if(t&&t.data.datasets.some(a=>a.year===l))return[];$.each(d,function(p,a){c.push(a.amount),o.push(a.year_month_jp)});const u=[];return c.length>0&&u.push({type:"line",label:l+"年",data:c,borderColor:r.borderColor,backgroundColor:r.backgroundColor,pointBackgroundColor:r.borderColor,pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",yearMonthJp:o,year:l}),u}$(document).on("click",".add_year_button",function(){const d="/client_detail/ajax_get_sales_data",i=$(this).data("base-client-id");$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:d,type:"GET",data:{client_id:$("#client_id").val(),year:$("#yearSelect_"+i).val(),base_client_id:i},dataType:"json",success:function(t){try{const n=t.client_sales[t.base_client_id]||[];if(n.length===0)return;const e="client_sales_chart_"+t.base_client_id,r=f(n,t.base_client_id),c=y.getChart(e);c.data.datasets.push(...r),c.update()}catch{alert("グラフの生成に失敗しました。")}},error:function(){alert("グラフの生成に失敗しました。")}})});
