import{C as _,p as x}from"./chartjs-plugin-datalabels.esm-CglBOSix.js";$(document).ready(function(){f()});function f(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/dashboard/ajax_get_chart_data",type:"GET",data:{},dataType:"json",success:function(t){try{let n=[],o=[],r=[];$.each(t.regions,function(e,a){n.push(a.region_name)});const b={labels:n,datasets:[C(t.regions)]};$.each(t.bases,function(e,a){o.push(a.short_base_name)});const c={labels:o,datasets:[m(t.bases)]};$.each(t.sales_rank_counts,function(e,a){r.push(a.sales_rank_name)});const g={labels:r,datasets:[k(t.sales_rank_counts)]},p=document.getElementById("clients_count_chart_by_region").getContext("2d"),y=document.getElementById("clients_count_chart_by_base").getContext("2d"),h=document.getElementById("sales_rank_chart").getContext("2d"),B=new _(p,{data:b,options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{callbacks:{label:function(e){return e.formattedValue}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6}}}}),A=new _(y,{data:c,options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{callbacks:{label:function(e){return e.formattedValue}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6}}}}),E=new _(h,{data:g,options:{responsive:!1,plugins:{legend:{labels:{boxWidth:0,usePointStyle:!1}},tooltip:{callbacks:{label:function(e){const a=e.raw,i=e.chart.data.datasets[e.datasetIndex].data.reduce((d,u)=>d+u,0),l=(a/i*100).toFixed(1);return a+" ("+l+"%)"}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6},datalabels:{color:"#000",font:{weight:"bold",size:15},formatter:(e,a)=>{const i=a.chart.data.datasets[0].data.reduce((d,u)=>d+u,0),l=(e/i*100).toFixed(1);return e+`
(`+l+"%)"},anchor:"center",align:"center"}}},plugins:[x]})}catch{alert("グラフの生成に失敗しました。")}},error:function(){alert("グラフの生成に失敗しました。")}})}function C(s){let t=[];return $.each(s,function(n,o){t.push(o.clients_count)}),{type:"bar",label:"顧客数(地域別)",data:t,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",pointBackgroundColor:"rgb(75, 192, 192)",pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",borderRadius:30}}function m(s){let t=[];return $.each(s,function(n,o){t.push(o.clients_count)}),{type:"bar",label:"顧客数(倉庫別)",data:t,borderColor:"rgb(255, 153, 180)",backgroundColor:"rgba(255, 153, 180, 0.5)",pointBackgroundColor:"rgb(255, 153, 180)",pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",borderRadius:30}}function k(s){let t=[];$.each(s,function(b,c){t.push(c.count)});const n=new Date,o=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0");return{type:"pie",label:`顧客数(売上ランク別) ${o}年${r}月`,data:t,borderColor:["#FF6384","#36A2EB","#4BC0C0","#FFCE56","#9966FF"],backgroundColor:["#FFB3BA","#BAE1FF","#BAFFC9","#FFFFBA","#E3BAFF"],pointBackgroundColor:["#FF6384","#36A2EB","#4BC0C0","#FFCE56","#9966FF"],yAxisID:"y-axis-pie"}}
