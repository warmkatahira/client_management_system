import{C as i,p as x}from"./chartjs-plugin-datalabels.esm-CglBOSix.js";$(document).ready(function(){C()});function C(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/dashboard/ajax_get_chart_data",type:"GET",data:{},dataType:"json",success:function(t){try{let e=[],n=[],r=[];$.each(t.regions,function(o,a){e.push(a.region_name)});const l={labels:e,datasets:[F(t.regions)]};$.each(t.bases,function(o,a){n.push(a.short_base_name)});const c={labels:n,datasets:[f(t.bases)]};$.each(t.sales_rank_counts,function(o,a){r.push(a.sales_rank_name)});const _={labels:r,datasets:[m(t.sales_rank_counts)]},u=document.getElementById("clients_count_chart_by_region").getContext("2d"),d=document.getElementById("clients_count_chart_by_base").getContext("2d"),b=document.getElementById("sales_rank_chart").getContext("2d"),B=new i(u,{data:l,options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10}}},plugins:{legend:{labels:{usePointStyle:!0}}}}}),k=new i(d,{data:c,options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10}}},plugins:{legend:{labels:{usePointStyle:!0}}}}}),A=new i(b,{data:_,options:{responsive:!1,plugins:{legend:{labels:{boxWidth:0,usePointStyle:!1}},datalabels:{color:"#000",font:{weight:"bold",size:15},formatter:(o,a)=>{const g=a.chart.data.datasets[0].data.reduce((y,h)=>y+h,0),p=(o/g*100).toFixed(1);return o+`
(`+p+"%)"},anchor:"center",align:"center"}}},plugins:[x]})}catch{alert("グラフの生成に失敗しました。")}},error:function(){alert("グラフの生成に失敗しました。")}})}function F(s){let t=[];return $.each(s,function(e,n){t.push(n.clients_count)}),{type:"bar",label:"顧客数(地域別)",data:t,borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",pointBackgroundColor:"rgb(75, 192, 192)",pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",borderRadius:30}}function f(s){let t=[];return $.each(s,function(e,n){t.push(n.clients_count)}),{type:"bar",label:"顧客数(倉庫別)",data:t,borderColor:"rgb(255, 153, 180)",backgroundColor:"rgba(255, 153, 180, 0.5)",pointBackgroundColor:"rgb(255, 153, 180)",pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",borderRadius:30}}function m(s){let t=[];$.each(s,function(l,c){t.push(c.count)});const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0");return{type:"pie",label:`顧客数(売上ランク別) ${n}年${r}月`,data:t,borderColor:["#FF6384","#36A2EB","#4BC0C0","#FFCE56","#9966FF"],backgroundColor:["#FFB3BA","#BAE1FF","#BAFFC9","#FFFFBA","#E3BAFF"],pointBackgroundColor:["#FF6384","#36A2EB","#4BC0C0","#FFCE56","#9966FF"],yAxisID:"y-axis-pie"}}
