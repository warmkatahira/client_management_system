import{a as r}from"./audio-BXh7UfBs.js";import{s as f}from"./loading-ChqFcCVw.js";$(document).ready(function(){a()});function a(){$("#item_id_code").focus(),$("#item_id_code").val(null)}$("#item_id_code").on("change",function(){$("#item_id_code").val()&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/receiving_inspection/ajax_check_item_id_code",type:"GET",data:{item_id_code:$("#item_id_code").val()},dataType:"json",success:function(t){try{if(t.error_message)throw new Error(t.error_message);if(t.exp_check_result)throw new Error(t.exp_check_result);if(t.add){const e=$("<tr>").attr("id",t.item_id).addClass("text-xs"),n=$("<button>").attr("type","button").addClass("btn item_change_modal_open bg-btn-enter text-white py-1 px-2").attr("data-item-jan-code",t.item_jan_code).attr("data-item-id",t.item_id).text("変更"),o=$("<button>").attr("type","button").addClass("btn item_delete_enter bg-btn-cancel text-white py-1 px-2").attr("data-item-id",t.item_id).text("削除"),d=$("<div>").addClass("flex flex-row justify-between").append(n,o),s=$("<td>").addClass("py-1 px-2 border").append(d),l=$("<td>").text(t.item_code).addClass("py-1 px-2 border"),m=$("<td>").text(t.item_jan_code).addClass("py-1 px-2 border"),u=$("<td>").text(t.item_name).addClass("py-1 px-2 border"),p=$("<td>").text(t.quantity).addClass("inspection_quantity py-1 px-2 border text-right").attr("id",t.item_id+"_quantity");e.append(s),e.append(l),e.append(m),e.append(u),e.append(p),$("#receiving_complete_table tbody").append(e)}t.add||$("#"+t.item_id+"_quantity").text(t.quantity),_(),r("proc"),a()}catch(e){r("ng"),$("#item_id_code_alert_modal").removeClass("hidden"),$("#error_message").html(e.message),$("#item_id_code_alert_modal_focus_element").focus()}},error:function(){alert("失敗")}})});function _(){let i=0;$(".inspection_quantity").each(function(){i+=parseInt($(this).text())}),$("#total_pcs").html(i)}$("#item_id_code_alert_modal_focus_element").on("change",function(){r("ng"),$("#item_id_code_alert_modal_focus_element").val(null),$("#item_id_code_alert_modal_focus_element").focus()});const c=$("#item_id_code_alert_modal_focus_element");c.on("blur",function(){setTimeout(()=>{c.focus()},0)});$(document).on("click",function(i){i.target.classList.contains("item_id_code_alert_modal_close")==!0&&($("#item_id_code_alert_modal").addClass("hidden"),a())});$("#receiving_inspection_enter").on("click",function(){try{if($("#total_pcs").html()==0||!$.isNumeric($("#total_pcs").html()))throw new Error("商品がスキャンされていません。");if($("#base_id").val()==="")throw new Error("入庫倉庫が選択されていません。");const i=prompt(`今回の入庫に対してコメントを入力して下さい。
※何もコメントを残さない場合は、このまま「OK」を押して下さい。`);if(i===null)throw new Error("キャンセルしました。");if(i.length>255)throw new Error("コメントは255文字以内で入力して下さい。");window.confirm("入庫検品確定を実行しますか？")==!0&&(f(),$("#comment").val(i),$("#receiving_inspection_enter_form").submit())}catch(i){alert(i.message)}});$(document).on("click",".item_delete_enter",function(){window.confirm("削除を実行しますか？")===!0&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/receiving_inspection/ajax_delete_item_id",type:"POST",data:{item_id:$(this).attr("data-item-id")},dataType:"json",success:function(e){$("#"+e.item_id).remove(),_(),a()},error:function(){alert("失敗")}})});$(document).on("click",".item_change_modal_open",function(){$("#item_change_enter").attr("data-item-id",$(this).attr("data-item-id")),$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/receiving_inspection/ajax_get_item_id_change_target",type:"POST",data:{item_jan_code:$(this).attr("data-item-jan-code")},dataType:"json",success:function(t){try{if(t.items.length<=1)throw new Error("変更できる商品の候補がありません。");$("#item_select_div").empty();const e=$("<label>").attr("for","change_item_id").addClass("w-56 bg-black text-white py-2.5 pl-3 relative").text("変更先商品").append($("<span>").addClass("absolute right-2 top-1/2 -translate-y-1/2 bg-white text-red-600 text-xs px-1.5 py-0.5 rounded").text("必須")),n=$("<select>").attr("id","change_item_id").attr("name","change_item_id").addClass("text-xs w-96 border px-2 py-1");t.items.forEach(o=>{const d=$("<option>").val(o.item_id).text(o.item_name);n.append(d)}),$("#item_select_div").append(e,n),$("#item_change_modal").removeClass("hidden")}catch(e){alert(e.message)}},error:function(){alert("失敗")}})});$("#item_change_enter").on("click",function(){try{if($("#"+$("#change_item_id").val()).length)throw new Error("変更しようとしている商品が既に存在します。");window.confirm("変更を実行しますか？")===!0&&$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/receiving_inspection/ajax_change_item_id",type:"POST",data:{item_id:$(this).attr("data-item-id"),change_item_id:$("#change_item_id").val()},dataType:"json",success:function(e){const n=$("#"+e.item_id);n.find("td").eq(1).text(e.item.item_code),n.find("td").eq(2).text(e.item.item_jan_code),n.find("td").eq(3).text(e.item.item_name),n.find("td").eq(4).attr("id",e.item.item_id+"_quantity"),n.find("button[data-item-id]").each(function(){$(this).attr("data-item-id",e.item.item_id)}),n.attr("id",e.item.item_id),$("#item_change_modal").addClass("hidden"),a()},error:function(){alert("失敗")}})}catch(i){alert(i.message)}});$(document).on("click",function(i){i.target.classList.contains("item_change_modal_close")===!0&&$("#item_change_modal").addClass("hidden")});
