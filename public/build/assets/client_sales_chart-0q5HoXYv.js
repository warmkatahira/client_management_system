import{C as m}from"./chartjs-plugin-datalabels.esm-CglBOSix.js";import{c as f}from"./chart_color-DSS5FTIa.js";$(document).ready(function(){C()});function C(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/client_detail/ajax_get_chart_data",type:"GET",data:{client_id:$("#client_id").val()},dataType:"json",success:function(e){try{const i=new Set([...Object.keys(e.current_year_client_sales),...Object.keys(e.last_year_client_sales)]),o=document.getElementById("client_sales_chart_div");o.innerHTML="",i.forEach(n=>{const s=e.current_year_client_sales[n]||[],l=e.last_year_client_sales[n]||[];if(s.length===0&&l.length===0)return;const p=(s[0]||l[0]).base_name,r=document.createElement("canvas");r.id="client_sales_chart_"+n,r.classList.add("w-full","p-2","bg-white","rounded-2xl","shadow-md","col-span-6"),r.height=300,o.appendChild(r);const h=Array.from({length:12},(t,c)=>c+1+"月"),_=b(e,n,p),u=r.getContext("2d");new m(u,{type:"line",data:{labels:h,datasets:_},options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:1e8,min:0,stepSize:1e6}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{callbacks:{title:function(t){return t[0].dataset.yearMonthJp[t[0].dataIndex]},label:function(t){return t.formattedValue+"円"}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6}}}})})}catch{alert("グラフの生成に失敗しました。")}},error:function(){alert("グラフの生成に失敗しました。")}})}function b(a,e,i){const o=f[0],n=f[1];let s=[],l=[],p=[],r=[];const h=a.current_year_client_sales.length===0?"":a.current_year_client_sales[e][0].year_month.split("-")[0];$.each(a.current_year_client_sales,function(t,c){parseInt(t)===parseInt(e)&&$.each(c,function(y,d){s.push(d.amount),p.push(d.year_month_jp)})});const _=a.last_year_client_sales.length===0?"":a.last_year_client_sales[e][0].year_month.split("-")[0];$.each(a.last_year_client_sales,function(t,c){parseInt(t)===parseInt(e)&&$.each(c,function(y,d){l.push(d.amount),r.push(d.year_month_jp)})});const u=[];return s.length>0&&u.push({type:"line",label:"売上推移（"+i+`@${h}年）`,data:s,borderColor:o.borderColor,backgroundColor:o.backgroundColor,pointBackgroundColor:o.borderColor,pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",yearMonthJp:p}),l.length>0&&u.push({type:"line",label:"売上推移（"+i+`@${_}年）`,data:l,borderColor:n.borderColor,backgroundColor:n.backgroundColor,pointBackgroundColor:n.borderColor,pointRadius:5,pointHoverRadius:7,borderDash:[5,5],yAxisID:"y-axis-1",yearMonthJp:r}),u}
